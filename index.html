<style>

</style>

<body>

    <div id="input_sentence"> Read this sentence</div>
    <div id="return_sentence"> this is what you said </div>
    
    <button id="recordButton">Record</button>
    <button id="stopButton">Stop</button>
    
    <label for="mySelect">Choose a language option:</label>
    <select id="mySelect" name="options">
        <option value="option1">Spanish</option>
        <option value="option2">English</option>
        <option value="option3">French</option>
    </select>
    <script>
        const recordButton = document.getElementById('recordButton');
        const stopButton = document.getElementById('stopButton');
        const returnSentence = document.getElementById('return_sentence');
        let mediaRecorder; 
        let audioChunks = [];

        const socket = new WebSocket('ws://localhost:8765'); //built-in object. url of our socket (its local in this case)

        // WebSocket event handlers
        socket.addEventListener('open', () => {
            console.log('WebSocket connection established'); //a use could be connect it to enable/not the record button
        });

        socket.addEventListener('message', (event) => {
            console.log('Message from server:', event.data);
            returnSentence.textContent = event.data; // Display message from server. ex: "an audio has been received"
        });

        socket.addEventListener('close', () => {
            console.log('WebSocket connection closed');
        });

        socket.addEventListener('error', (error) => {
            console.error('WebSocket error:', error);
        });

        recordButton.addEventListener('click', async () => { //standarised procedure 
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true }); //built-in function of mozilla to get the media of the user
            mediaRecorder = new MediaRecorder(stream); //object pre-built

            mediaRecorder.ondataavailable = event => { //event = the object has changed in some way. every ms that you talk and it gets saved in the array
                audioChunks.push(event.data);  //saving the audio into an array
            };

            mediaRecorder.onstop = () => {
                const audioBlob = new Blob(audioChunks, { type: 'audio/wav' }); //standarised object to store the mide. wav is binary
                audioChunks = []; 
                socket.send(audioBlob);
            };

            mediaRecorder.start();
            //socket.send(JSON.stringify({ event: 'start' })); // Notify server that recording has started
        });

        stopButton.addEventListener('click', () => {
            mediaRecorder.stop();
            //socket.send(JSON.stringify({ event: 'stop' })); // Notify server that recording has stopped
        });
    </script>
</body>